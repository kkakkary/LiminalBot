{"version":3,"sources":["../../../../../src/lib/utils/application-commands/computeDifferences.ts"],"names":["ApplicationCommandType","contextMenuTypes","casted","checkName","checkDMPermission","checkDefaultMemberPermissions","originalLocalizedNames","expectedLocalizedNames","checkLocalizations","checkIntegrationTypes","checkInteractionContextTypes","checkDescription","checkOptions"],"mappings":"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","file":"computeDifferences.cjs","sourcesContent":["import {\n\tApplicationCommandType,\n\ttype RESTPostAPIApplicationCommandsJSONBody,\n\ttype RESTPostAPIChatInputApplicationCommandsJSONBody,\n\ttype RESTPostAPIContextMenuApplicationCommandsJSONBody\n} from 'discord-api-types/v10';\nimport type { InternalAPICall } from './ApplicationCommandRegistry';\nimport { contextMenuTypes, type CommandDifference } from './compute-differences/_shared';\nimport { checkDefaultMemberPermissions } from './compute-differences/default_member_permissions';\nimport { checkDescription } from './compute-differences/description';\nimport { checkDMPermission } from './compute-differences/dm_permission';\nimport { checkLocalizations } from './compute-differences/localizations';\nimport { checkName } from './compute-differences/name';\nimport { checkOptions } from './compute-differences/options';\nimport { checkIntegrationTypes } from './compute-differences/integration_types';\nimport { checkInteractionContextTypes } from './compute-differences/contexts';\n\n/**\n * @returns `true` if there are differences, `false` otherwise\n */\nexport function getCommandDifferencesFast(\n\texistingCommand: RESTPostAPIApplicationCommandsJSONBody,\n\tapiData: InternalAPICall['builtData'],\n\tguildCommand: boolean\n) {\n\tfor (const _ of getCommandDifferences(existingCommand, apiData, guildCommand)) {\n\t\t// Return immediately on first difference found (also means we skip all other checks)\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nexport function* getCommandDifferences(\n\texistingCommand: RESTPostAPIApplicationCommandsJSONBody,\n\tapiData: InternalAPICall['builtData'],\n\tguildCommand: boolean\n): Generator<CommandDifference> {\n\tif (existingCommand.type !== ApplicationCommandType.ChatInput && existingCommand.type) {\n\t\t// Check context menus\n\t\tif (contextMenuTypes.includes(existingCommand.type ?? ApplicationCommandType.ChatInput)) {\n\t\t\tconst casted = apiData as RESTPostAPIContextMenuApplicationCommandsJSONBody;\n\n\t\t\t// Check name\n\t\t\tyield* checkName({ oldName: existingCommand.name, newName: casted.name });\n\n\t\t\t// Check dmPermission only for non-guild commands\n\t\t\tif (!guildCommand) {\n\t\t\t\tyield* checkDMPermission(existingCommand.dm_permission, casted.dm_permission);\n\t\t\t}\n\n\t\t\t// Check defaultMemberPermissions\n\t\t\tyield* checkDefaultMemberPermissions(existingCommand.default_member_permissions, casted.default_member_permissions);\n\n\t\t\t// Check localized names\n\t\t\tconst originalLocalizedNames = existingCommand.name_localizations;\n\t\t\tconst expectedLocalizedNames = casted.name_localizations;\n\n\t\t\tyield* checkLocalizations({\n\t\t\t\tlocaleMapName: 'nameLocalizations',\n\t\t\t\tlocalePresentMessage: 'localized names',\n\t\t\t\tlocaleMissingMessage: 'no localized names',\n\t\t\t\toriginalLocalizedDescriptions: originalLocalizedNames,\n\t\t\t\texpectedLocalizedDescriptions: expectedLocalizedNames\n\t\t\t});\n\n\t\t\t// Check integration types\n\t\t\tyield* checkIntegrationTypes(existingCommand.integration_types, casted.integration_types);\n\n\t\t\t// Check contexts\n\t\t\tyield* checkInteractionContextTypes(existingCommand.contexts, casted.contexts);\n\t\t}\n\n\t\treturn;\n\t}\n\n\tconst casted = apiData as RESTPostAPIChatInputApplicationCommandsJSONBody;\n\n\t// Check name\n\tyield* checkName({ oldName: existingCommand.name.toLowerCase(), newName: casted.name.toLowerCase() });\n\n\t// Check localized names\n\tconst originalLocalizedNames = existingCommand.name_localizations;\n\tconst expectedLocalizedNames = casted.name_localizations;\n\n\tyield* checkLocalizations({\n\t\tlocaleMapName: 'nameLocalizations',\n\t\tlocalePresentMessage: 'localized names',\n\t\tlocaleMissingMessage: 'no localized names',\n\t\toriginalLocalizedDescriptions: originalLocalizedNames,\n\t\texpectedLocalizedDescriptions: expectedLocalizedNames\n\t});\n\n\t// Check dmPermission\n\tif (!guildCommand) {\n\t\tyield* checkDMPermission(existingCommand.dm_permission, casted.dm_permission);\n\t}\n\n\t// Check defaultMemberPermissions\n\tyield* checkDefaultMemberPermissions(existingCommand.default_member_permissions, casted.default_member_permissions);\n\n\t// Check description\n\tyield* checkDescription({ oldDescription: existingCommand.description, newDescription: casted.description });\n\n\t// Check localized descriptions\n\tconst originalLocalizedDescriptions = existingCommand.description_localizations;\n\tconst expectedLocalizedDescriptions = casted.description_localizations;\n\n\tyield* checkLocalizations({\n\t\tlocaleMapName: 'descriptionLocalizations',\n\t\tlocalePresentMessage: 'localized descriptions',\n\t\tlocaleMissingMessage: 'no localized descriptions',\n\t\toriginalLocalizedDescriptions,\n\t\texpectedLocalizedDescriptions\n\t});\n\n\t// Check integration types\n\tyield* checkIntegrationTypes(existingCommand.integration_types, casted.integration_types);\n\n\t// Check contexts\n\tyield* checkInteractionContextTypes(existingCommand.contexts, casted.contexts);\n\n\tyield* checkOptions(existingCommand.options, casted.options);\n}\n"]}